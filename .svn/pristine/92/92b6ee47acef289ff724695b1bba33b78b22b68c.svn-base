@extends('common.header')

@section('content')

    <link href="{{ asset('css/register.css') }}" rel="stylesheet">
    <style>
        .form{margin: 1rem auto 0 auto;}
    </style>

    <div id="banner">
        <div class="banner-img">
            <div class="layui-container">
                <div class="banner-content">{{$type == 'personal' ? '个人' : '企业'}}注册<br>欢迎您注册美和国际物流{{$type == 'personal' ? '个人' : '企业'}}用户</div>
            </div>
        </div>
    </div>
    <div class="layui-container">
        <div class="content">
            <div class="content-titleimg">
                @for($i = 1;$i < 7; $i++)
                    @php
                        $imgType = $nowStep >= $i ? '1' : '0'
                    @endphp
                    <div class="step layui-inline">
                        <div><span class="title-header">{{$i}}</span><img src="{{asset('images/register-tip'.$imgType.'.png')}}"><span class="title-footer @if($nowStep >= $i) active @endif">{{$titles[$i-1]}}</span></div>
                    </div>
                @endfor
            </div>

            <div class="titlecontent">
                <h1>上传您的认证信息</h1>
                <div>
                    根据进出口海关申报要求，请您上传以下证件的扫描件，美中仅在进出口报关使用，承诺不会向第三方提供此信息。
                </div>
                <div class="layui-text">
                    单个上传文件最大为2M，支持JPG，PNG，GIF，JPEG
                </div>
            </div>
            <form class="layui-form" action="">
                {{csrf_field()}}
                <div class="layui-row">
                    <div class="layui-col-sm12 layui-col-md4 text-center">
                        <div class="upload-img-content">上传身份证/驾照/护照 *</div>
                        <div id="sfz" class="upload-img"><i class="layui-icon layui-icon-picture"></i></div>
                        <div class="upload-img-content">(*)为必填项</div>
                    </div>
                    <div class="layui-col-sm12 layui-col-md4 text-center">
                        <div class="upload-img-content">上传信用卡或银行账单</div>
                        <div id="xyk" class="upload-img"><i class="layui-icon layui-icon-picture"></i></div>
                    </div>
                    <div class="layui-col-sm12 layui-col-md4 text-center">
                        <div class="upload-img-content">上传水/电/煤气账单</div>
                        <div id="sdm" class="upload-img"><i class="layui-icon layui-icon-picture"></i></div>
                    </div>
                </div>
                <div class="form">
                    <div class="layui-form-item">
                        <button class="layui-btn sub-btn" id="sub-btn" lay-submit lay-filter="do">下一步</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    @include('common.footer')

    <script>
        layui.use(['form','upload'], function(){
            var form = layui.form
                    ,upload = layui.upload
                    ,$ = layui.jquery;

            var uploadInst = upload.render({
                elem: '#sfz'
                ,url: '{{url('/register/four/'.$type.'/uploadImg')}}'
                ,data:{_token:$("input[name=_token]").val()}
                ,accept:'images'
                ,size: 2*1024
                ,field: 'sfz'
                ,choose: function(obj){
                    //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                    obj.preview(function(index, file, result){
                        $("#sfz").find("i").remove();
                        $("#sfz").css("background","url('"+result+"')");
                        $("#sfz").css("background-position","center center");
                        $("#sfz").css("background-repeat","no-repeat");
                        $("#sfz").css("background-size","cover");
                    });
                }
            });

            var uploadInst1 = upload.render({
                elem: '#xyk'
                ,url: '{{url('/register/four/'.$type.'/uploadImg')}}'
                ,auto: false
                ,bindAction: '.sub-btn'
                ,accept:'images'
                ,size: 2*1024
                ,field: 'xyk'
                ,choose: function(obj){
                    //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                    obj.preview(function(index, file, result){
                        console.log(file); //得到文件对象
                        $("#xyk").find("i").remove();
                        $("#xyk").css("background","url('"+result+"')");
                        $("#xyk").css("background-position","center center");
                        $("#xyk").css("background-repeat","no-repeat");
                        $("#xyk").css("background-size","cover");
                    });
                }
            });

            var uploadInst2 = upload.render({
                elem: '#sdm'
                ,url: '{{url('/register/four/'.$type.'/uploadImg')}}'
                ,auto: false
                ,bindAction: '.sub-btn'
                ,accept:'images'
                ,size: 2*1024
                ,field: 'sdm'
                ,choose: function(obj){
                    //预读本地文件，如果是多文件，则会遍历。(不支持ie8/9)
                    obj.preview(function(index, file, result){
                        console.log(file); //得到文件对象
                        $("#sdm").find("i").remove();
                        $("#sdm").css("background","url('"+result+"')");
                        $("#sdm").css("background-position","center center");
                        $("#sdm").css("background-repeat","no-repeat");
                        $("#sdm").css("background-size","cover");
                    });
                }
            });

            form.on('submit(do)', function(data){
                $.ajax({
                    type : "POST",
                    url : "{{url()->current().'/do'}}",
                    data : data.field,
                    dataType: 'json',
                    success : function(result) {
                        console.log(result);
                        if (result.status == 200){
                            window.location.href='{{url('/register/five/'.$type)}}';
                        } else {
                            layer.alert(result.msg);
                        }
                    },
                    error: function (error) {
                        var errors = error.responseJSON.errors;
                        $.each(errors, function (key, value) {
                            layer.msg(value[0]);
                            return false;
                        });
                    }
                });
                return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            });
        });
    </script>
@endsection