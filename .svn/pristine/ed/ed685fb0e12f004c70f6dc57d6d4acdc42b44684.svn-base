<?php

namespace App\Http\Controllers\Index;

use App\Content;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

class IndexController extends Controller
{
    private $partner,$inform;

    public function __construct(){
        $this->partner = Content::where(['type'=>4,'isban'=>'0'])->orderBy('order','DESC')->orderBy('created_at','DESC')->get();
        $this->inform = Content::select('title')->where(['type'=>5,'isban'=>'0'])->orderBy('order','DESC')->orderBy('created_at','DESC')->first();
    }

    public function index(){
        $banner = Content::where(['type'=>3,'isban'=>'0'])->orderBy('order','DESC')->orderBy('created_at','DESC')->limit(5)->get();
        $output['banner'] = $banner;
        $output['expert'] = [1,2,3,4];
        $output['partner'] = $this->partner;
        $output['inform'] = $this->inform;
        return view('index.index',$output);
    }

    public function service(){
        $info = Content::where('type',1)->first();
        $output['partner'] = $this->partner;
        $output['inform'] = $this->inform;
        $output['content'] = $info['content'];
        return view('index.service',$output);
    }

    public function charge(){
        $info = Content::where('type',2)->first();
        $output['partner'] = $this->partner;
        $output['inform'] = $this->inform;
        $output['content'] = $info['content'];
        return view('index.charge',$output);
    }

    public function about(){
        $output['partner'] = $this->partner;
        $output['inform'] = $this->inform;
        return view('index.about',$output);
    }

    public function news(){
        $output['data'] = Content::select(['id','title','created_at'])->where(['type'=>5,'isban'=>'0'])->orderBy('order','DESC')->orderBy('created_at','DESC')->limit(15)->get();
        $output['inform'] = $this->inform;
        return view('index.news',$output);
    }

    public function newsDetail($id){
        $output['info'] = Content::find($id);
        if (!isset($output['info']) || empty($output['info'])) return redirect()->back();
        $output['inform'] = $this->inform;
        return view('index.newsDetail',$output);
    }

    public function identification(){
        $output['inform'] = $this->inform;
        $output['nowStep'] = 1;
        $output['titles'] = ["快件信息","补充身份证信息及在线缴税","完成"];
        return view('index.identification',$output);
    }

    public function tax(){

    }
}
